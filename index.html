<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸­è¯è±¡æ£‹ç¥å¦ v1.0.0</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="è±¡æ£‹ç¥å¦">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <style>
        /* --- App æ•´é«”ç´…é‡‘é¢¨æ ¼ --- */
        :root {
            --primary-red: #b71c1c; 
            --bright-red: #d32f2f;
            --primary-gold: #FFD700; 
            --deep-gold: #DAA520;
            --text-dark: #3e2723;
        }

        body {
            font-family: "PingFang TC", "Microsoft JhengHei", "Heiti TC", sans-serif;
            background: linear-gradient(135deg, #8e0e00 0%, #1f1c18 100%);
            margin: 0; padding: 0;
            display: flex; justify-content: center;
            height: 100vh; overflow: hidden;
            color: var(--text-dark);
            -webkit-tap-highlight-color: transparent;
        }

        #app-container {
            width: 100%; max-width: 480px;
            background: linear-gradient(165deg, #FFF9C4 0%, #FFD54F 40%, #FF8F00 100%);
            display: flex; flex-direction: column;
            position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
        }

        header {
            background: linear-gradient(to bottom, #d32f2f, #8e0e00);
            color: var(--primary-gold);
            padding: 15px; text-align: center;
            font-size: 1.6rem; font-weight: bold;
            border-bottom: 3px solid var(--primary-gold);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .content { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .page { display: none; width: 100%; animation: fadeIn 0.6s ease-out; }
        .page.active { display: flex; flex-direction: column; align-items: center; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .btn {
            background: linear-gradient(180deg, #d32f2f 0%, #8e0e00 100%);
            color: var(--primary-gold);
            border: 2px solid var(--primary-gold);
            padding: 12px 40px; border-radius: 50px;
            font-size: 1.2rem; font-weight: bold;
            margin-top: 25px; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        /* æ£‹å­æ¨£å¼ */
        .chess-piece {
            width: 54px; height: 54px; border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #ffffff, #e6cba5, #b8860b);
            border: 2px solid #5d4037;
            box-shadow: 3px 5px 8px rgba(0,0,0,0.4), inset 0 0 5px rgba(255,255,255,0.8);
            display: flex; justify-content: center; align-items: center;
            font-size: 1.85rem; font-family: "KaiTi", "BiauKai", serif; font-weight: 900;
        }
        .red-piece { color: #d50000; text-shadow: 1px 1px 0px #fff; }
        .black-piece { color: #111; text-shadow: 1px 1px 0px #aaa; }

        .result-box {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px; padding: 12px;
            margin-top: 10px; width: 92%;
            border-left: 6px solid var(--primary-red);
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        .analysis-card {
            background: linear-gradient(135deg, #8e0e00, #d32f2f);
            padding: 4px; border-radius: 16px; margin-top: 20px; width: 95%;
        }
        .analysis-inner { background: #fff; padding: 18px; border-radius: 13px; line-height: 1.7; }
        
        .grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 15px; }
        .number-btn {
            width: 50px; height: 50px; background: var(--primary-red); color: #fff;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-weight: bold; border: 2.5px solid var(--primary-gold); cursor: pointer;
        }
        .number-btn.selected { background: var(--primary-gold); color: var(--primary-red); transform: scale(1.1); }
    </style>
</head>
<body>

<div id="app-container">
    <header>
        âœ¨ ä¸­è¯è±¡æ£‹ç¥å¦ V1.0 âœ¨
    </header>

    <div id="page-home" class="content page active">
        <div style="margin-top:30px; font-size:4rem; text-align:center;">ğŸ</div>
        <h2>èª å¿ƒæ±‚å•</h2>
        <div style="text-align: left; background: white; padding: 20px; border-radius: 10px; width:80%;">
            <h3 style="margin-top:0; color:var(--primary-red);">åœå¦ä¸‰åŸå‰‡</h3>
            <ul style="padding-left: 20px; color: #555;">
                <li><b>ä¸èª ä¸å ï¼š</b>å¿ƒå­˜ç©ç¬‘å‹¿è©¦ã€‚</li>
                <li><b>ä¸ç¾©ä¸å ï¼š</b>å‚·å¤©å®³ç†å‹¿å•ã€‚</li>
                <li><b>ä¸ç–‘ä¸å ï¼š</b>å·²æœ‰å®šè¦‹å‹¿åœã€‚</li>
            </ul>
        </div>
        <button class="btn" onclick="goToPage('page-question')">é–‹å§‹åœå¦</button>
    </div>

    <div id="page-question" class="content page">
        <h3>1. è«‹è¼¸å…¥å¿ƒä¸­ç–‘æƒ‘</h3>
        <input type="text" id="userQuestion" placeholder="ä¾‹å¦‚ï¼šé€™å€‹æŠ•è³‡é …ç›®å¯è¡Œå—ï¼Ÿ">
        
        <h3>2. é¸æ“‡å¦è±¡æ¨¡å¼</h3>
        <div class="mode-card" onclick="selectMode(1)">
            <h3 style="margin:0; color:#d32f2f;">å–®å  (æ˜¯é)</h3>
            <p style="margin:5px 0 0; color:#666; font-size:0.9rem;">ä¸€ç¿»å…©çªçœ¼ï¼Œé€Ÿæ–·å‰å‡¶ã€‚</p>
        </div>
        <div class="mode-card" onclick="selectMode(3)">
            <h3 style="margin:0; color:#d32f2f;">ä¸‰æ‰ (å› æœ)</h3>
            <p style="margin:5px 0 0; color:#666; font-size:0.9rem;">åˆ†æå‰å› ã€éç¨‹èˆ‡å¾Œæœã€‚</p>
        </div>
        <div class="mode-card" onclick="selectMode(5)">
            <h3 style="margin:0; color:#d32f2f;">äº”è¡Œ (æ–¹ä½)</h3>
            <p style="margin:5px 0 0; color:#666; font-size:0.9rem;">è‡ªèº«èˆ‡å‘¨é­ç’°å¢ƒçš„å…¨ç›¤åˆ†æã€‚</p>
        </div>
    </div>

    <div id="page-selection" class="content page">
        <h3 id="selection-prompt">è«‹æ†‘ç›´è¦ºé¸è™Ÿ</h3>
        <p id="selection-progress" style="color:#d32f2f; font-weight:bold;">é€²åº¦ï¼š0 / 3</p>
        <div class="grid-container" id="selection-grid">
            </div>
    </div>

    <div id="page-verify" class="content page">
        <h3>âœ¨ é©—è­‰ç’°ç¯€ âœ¨</h3>
        <p style="font-size:0.9rem; text-align:center; margin:0 0 10px 0;">
            è«‹ç¢ºèªå…¶é¤˜æœªé¸ä¸­çš„æ£‹å­çš†åœ¨å…¶ä¸­ã€‚<br>ç«¥åŸç„¡æ¬ºï¼Œå¤©æ©Ÿé¡¯ç¾ã€‚
        </p>
        <div class="grid-container" id="verify-grid">
            </div>
        <button class="btn" id="btn-reveal-result" onclick="showResult()" style="margin-top: 15px;">
            ç¢ºèªç„¡èª¤ï¼Œè§£æå¦è±¡
        </button>
    </div>

    <div id="page-result" class="content page">
        <h3 style="margin-bottom:5px;">å¦è±¡è§£æ</h3>
        <div style="font-size:0.9rem; color:#666; margin-bottom:15px; background:#fff; padding:5px 15px; border-radius:10px;">
            å•ï¼š<span id="result-question-display"></span>
        </div>
        
        <div class="analysis-card">
            <div class="analysis-inner">
                <div class="total-score" id="total-score-display">ç¸½åˆ†ï¼š0</div>
                <div style="font-weight:bold; color:#333; margin-bottom:5px;">ã€å¤§å¸«ç¶œæ•´åˆ†æã€‘</div>
                <div id="ai-analysis-text" style="font-size:0.95rem; line-height:1.6; color:#555;">
                    </div>
            </div>
        </div>

        <h4 style="margin: 20px 0 10px 0; color:#888;">è©³ç´°å¦ç¾©ï¼š</h4>
        <div id="result-details" style="width:100%; display:flex; flex-direction:column; align-items:center;">
            </div>

        <button class="btn" onclick="resetApp()" style="margin-bottom:30px; background: #555;">é‡æ–°åœå¦</button>
    </div>
</div>

<script>
    /* --- è³‡æ–™å®šç¾© (å«åˆ†æ•¸) --- */
    // æ ¹æ“šæ‚¨çš„éœ€æ±‚å®šç¾©åˆ†æ•¸ï¼š
    // å¸¥+10, å°‡-10, ä»•+8, å£«-8, ç›¸+7, è±¡-7, ä¿¥+6, è»Š-6, å‚Œ+5, é¦¬-5, ç‚®+4, åŒ…-4, å…µ+1, å’-1
    const rawChessData = [
        { name: "å¸¥", color: "red", score: 10, meaning: "æ“ä¹‹åœ¨å·± / å¥½ / æ˜¯" },
        { name: "å°‡", color: "black", score: -10, meaning: "å—åˆ¶æ–¼äºº / ä¸å¥½ / å¦" },
        { name: "ä»•", color: "red", score: 8, meaning: "å¹³æ­¥é’é›²" },
        { name: "ä»•", color: "red", score: 8, meaning: "å¹³æ­¥é’é›²" },
        { name: "å£«", color: "black", score: -8, meaning: "æ±Ÿæ²³æ—¥ä¸‹" },
        { name: "å£«", color: "black", score: -8, meaning: "æ±Ÿæ²³æ—¥ä¸‹" },
        { name: "ç›¸", color: "red", score: 7, meaning: "å‰äººå¤©ç›¸" },
        { name: "ç›¸", color: "red", score: 7, meaning: "å‰äººå¤©ç›¸" },
        { name: "è±¡", color: "black", score: -7, meaning: "ç›²äººæ‘¸è±¡" },
        { name: "è±¡", color: "black", score: -7, meaning: "ç›²äººæ‘¸è±¡" },
        { name: "ä¿¥", color: "red", score: 6, meaning: "æ·±è¬€é æ…®" },
        { name: "ä¿¥", color: "red", score: 6, meaning: "æ·±è¬€é æ…®" },
        { name: "è»Š", color: "black", score: -6, meaning: "æ©«è¡ç›´æ’" },
        { name: "è»Š", color: "black", score: -6, meaning: "æ©«è¡ç›´æ’" },
        { name: "å‚Œ", color: "red", score: 5, meaning: "é¦¬åˆ°æˆåŠŸ" },
        { name: "å‚Œ", color: "red", score: 5, meaning: "é¦¬åˆ°æˆåŠŸ" },
        { name: "é¦¬", color: "black", score: -5, meaning: "é¦¬å¤±å‰è¹„" },
        { name: "é¦¬", color: "black", score: -5, meaning: "é¦¬å¤±å‰è¹„" },
        { name: "ç‚®", color: "red", score: 4, meaning: "ä¸€ç‚®è€Œç´…" },
        { name: "ç‚®", color: "red", score: 4, meaning: "ä¸€ç‚®è€Œç´…" },
        { name: "åŒ…", color: "black", score: -4, meaning: "æ™‚é‹ä¸æ¿Ÿ" }, 
        { name: "åŒ…", color: "black", score: -4, meaning: "æ™‚é‹ä¸æ¿Ÿã€" },
        { name: "å…µ", color: "red", score: 1, meaning: "å‹‡å¾€ç›´å‰" },
        { name: "å…µ", color: "red", score: 1, meaning: "å‹‡å¾€ç›´å‰" },
        { name: "å…µ", color: "red", score: 1, meaning: "å‹‡å¾€ç›´å‰" },
        { name: "å…µ", color: "red", score: 1, meaning: "å‹‡å¾€ç›´å‰" },
        { name: "å…µ", color: "red", score: 1, meaning: "å‹‡å¾€ç›´å‰" },
        { name: "å’", color: "black", score: -1, meaning: "å‹¢å–®åŠ›è–„" },
        { name: "å’", color: "black", score: -1, meaning: "å‹¢å–®åŠ›è–„" },
        { name: "å’", color: "black", score: -1, meaning: "å‹¢å–®åŠ›è–„" },
        { name: "å’", color: "black", score: -1, meaning: "å‹¢å–®åŠ›è–„" },
        { name: "å’", color: "black", score: -1, meaning: "å‹¢å–®åŠ›è–„" }
    ];

    /* --- ç‹€æ…‹è®Šæ•¸ --- */
    let currentMode = 3; 
    let shuffledDeck = []; // æ´—ç‰Œå¾Œçš„é™£åˆ—
    let selectedIndices = []; // ä½¿ç”¨è€…é¸äº†ç¬¬å¹¾å€‹ä½ç½® (0-31)
    
    const labels = {
        1: ["çµæœ"],
        3: ["å›  (åŸå› )", "éç¨‹ (ç™¼å±•)", "æœ (çµæœ)"],
        5: ["è‡ªå·± (ä¸­å¿ƒ)", "é…å¶/å¦»è²¡ (å·¦)", "æœ‹å‹/æ‰‹è¶³ (å³)", "é•·è¼©/äº‹æ¥­ (ä¸Š)", "å­å­«/è²¡åº« (ä¸‹)"]
    };

    /* --- åŠŸèƒ½å‡½æ•¸ --- */

    function goToPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
    }

    function selectMode(mode) {
        const q = document.getElementById('userQuestion').value.trim();
        if(!q) { alert("è«‹å…ˆè¼¸å…¥æ‚¨çš„å•é¡Œï¼"); return; }
        
        currentMode = mode;
        selectedIndices = [];
        
        // æ´—ç‰Œ (Fisher-Yates)
        shuffledDeck = [...rawChessData];
        for (let i = shuffledDeck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffledDeck[i], shuffledDeck[j]] = [shuffledDeck[j], shuffledDeck[i]];
        }

        // å»ºç«‹ 32 å€‹é¸è™ŸæŒ‰éˆ• (é¡¯ç¤º 1-32)
        const grid = document.getElementById('selection-grid');
        grid.innerHTML = "";
        for (let i = 0; i < 32; i++) {
            const btn = document.createElement('div');
            btn.className = 'number-btn';
            btn.textContent = i + 1;
            btn.dataset.index = i;
            btn.onclick = function() { pickNumber(this, i); };
            grid.appendChild(btn);
        }

        updateProgress();
        goToPage('page-selection');
    }

    function pickNumber(btn, index) {
        if(selectedIndices.length >= currentMode || btn.classList.contains('selected')) return;

        btn.classList.add('selected');
        selectedIndices.push(index);
        updateProgress();

        // é¸æ»¿äº† -> é€²å…¥é©—è­‰ç’°ç¯€
        if (selectedIndices.length === currentMode) {
            setTimeout(showVerifyPage, 600);
        }
    }

    function updateProgress() {
        document.getElementById('selection-progress').textContent = 
            `é€²åº¦ï¼š${selectedIndices.length} / ${currentMode}`;
    }

    // --- é©—è­‰ç’°ç¯€ (æ–°åŠŸèƒ½) ---
    function showVerifyPage() {
        goToPage('page-verify');
        const grid = document.getElementById('verify-grid');
        grid.innerHTML = "";

        // é¡¯ç¤ºæ‰€æœ‰ 32 é¡†æ£‹å­
        shuffledDeck.forEach((piece, idx) => {
            const isChosen = selectedIndices.includes(idx);
            
            // å»ºç«‹æ£‹å­ DOM
            const pieceDiv = document.createElement('div');
            pieceDiv.className = `chess-piece ${piece.color === 'red' ? 'red-piece' : 'black-piece'} verify-piece ${isChosen ? 'is-chosen' : ''}`;
            pieceDiv.innerText = piece.name; // é€™è£¡ç›´æ¥ç¿»é–‹ï¼Œå±•ç¤ºã€Œç«¥åŸç„¡æ¬ºã€
            
            grid.appendChild(pieceDiv);
        });
    }

    // --- ç”¢ç”Ÿçµæœ ---
    function showResult() {
        const questionText = document.getElementById('userQuestion').value;
        document.getElementById('result-question-display').textContent = questionText;
        
        const detailsContainer = document.getElementById('result-details');
        detailsContainer.innerHTML = "";
        
        let totalScore = 0;
        let analysisParts = [];

        // ä¾ç…§ä½¿ç”¨è€…é¸æ“‡çš„é †åºå–å‡ºæ£‹å­
        selectedIndices.forEach((deckIndex, i) => {
            const piece = shuffledDeck[deckIndex];
            totalScore += piece.score;
            
            const positionLabel = labels[currentMode][i] || `ä½ç½® ${i+1}`;
            
            // å»ºç«‹è©³ç´°åˆ—è¡¨ DOM
            const row = document.createElement('div');
            row.className = 'result-box result-row';
            row.innerHTML = `
                <div class="chess-piece result-piece ${piece.color === 'red' ? 'red-piece' : 'black-piece'}">
                    ${piece.name}
                </div>
                <div class="result-text-group">
                    <span class="meaning-label">${positionLabel}</span>
                    <span class="meaning-main">${piece.meaning}</span>
                </div>
                <div class="score-badge">${piece.score > 0 ? '+' : ''}${piece.score}åˆ†</div>
            `;
            detailsContainer.appendChild(row);

            // æ”¶é›†åˆ†æç´ æ
            analysisParts.push({ label: positionLabel, meaning: piece.meaning, pieceName: piece.name });
        });

        // æ›´æ–°ç¸½åˆ†
        const scoreDisplay = document.getElementById('total-score-display');
        scoreDisplay.textContent = `ç¸½ç©åˆ†ï¼š${totalScore}`;
        if(totalScore > 0) scoreDisplay.style.color = "#D32F2F"; // ç´…
        else if(totalScore < 0) scoreDisplay.style.color = "#333"; // é»‘
        else scoreDisplay.style.color = "#888";

        // ç”Ÿæˆä¸¦é¡¯ç¤ºæ™ºæ…§åˆ†æ
        const analysisText = generateAnalysisText(questionText, totalScore, analysisParts);
        document.getElementById('ai-analysis-text').innerHTML = analysisText;

        goToPage('page-result');
    }

    // --- æ™ºæ…§ç¶œæ•´åˆ†æ (æ¨¡æ“¬ AI) ---
    function generateAnalysisText(question, score, parts) {
        let luckLevel = "";
        let advice = "";

        // 1. åˆ¤æ–·å‰å‡¶ç­‰ç´š
        if (score >= 15) {
            luckLevel = "ã€å¤§å‰ã€‘æ°£å‹¢å¦‚è™¹ï¼Œå¿ƒæƒ³äº‹æˆã€‚";
            advice = "ç›®å‰é‹å‹¢æ¥µä½³ï¼Œå»ºè­°æŠŠæ¡æ©Ÿæœƒç©æ¥µè¡Œå‹•ï¼Œåˆ‡å‹¿çŒ¶è±«ã€‚";
        } else if (score >= 5) {
            luckLevel = "ã€å‰ã€‘é‹å‹¢å¹³ç©©ï¼Œç©©æ­¥å‘å‰ã€‚";
            advice = "é›–ç„¶ä¸æ˜¯ä¸€é£›æ²–å¤©ï¼Œä½†åªè¦æŒ‰éƒ¨å°±ç­ï¼Œçµæœå¤šç‚ºæ­£å‘ã€‚";
        } else if (score >= -5) {
            luckLevel = "ã€å¹³ã€‘å‰å‡¶åƒåŠï¼Œè®Šæ•¸ä»å¤šã€‚";
            advice = "å±€å‹¢å°šæœªæ˜æœ—æˆ–æœ‰å¥½æœ‰å£ï¼Œå»ºè­°ä¿å®ˆè¡Œäº‹ï¼Œå¤šè§€å¯Ÿå†è¡Œå‹•ã€‚";
        } else {
            luckLevel = "ã€å‡¶ã€‘é˜»ç¤™é‡é‡ï¼Œä¸å®œèºé€²ã€‚";
            advice = "ç›®å‰çš„æ™‚æ©Ÿé»è¼ƒå·®ï¼Œå®¹æ˜“é‡åˆ°é˜»ç¤™æˆ–å°äººï¼Œå»ºè­°æš«ç·©è¨ˆç•«ï¼Œä¿®èº«é¤Šæ€§ã€‚";
        }

        // 2. çµ„åˆå¥å­
        let content = `é‡å°æ‚¨æ‰€å•çš„ã€Œ<b>${question}</b>ã€ï¼Œç¶œåˆè©•åˆ†ç‚º <b>${score}åˆ†</b>ï¼Œå±¬æ–¼${luckLevel}<br><br>`;
        
        content += "å¾å¦è±¡çµæ§‹ä¾†çœ‹ï¼š<br>";
        parts.forEach(p => {
            content += `â— <b>${p.label}</b>å‡ºç¾äº†ã€Œ${p.pieceName}ã€ï¼Œæš—ç¤º${p.meaning}ã€‚<br>`;
        });

        content += `<br><b>ğŸ’¡ å»ºè­°ï¼š</b>${advice}`;

        return content;
    }

    function resetApp() {
        document.getElementById('userQuestion').value = "";
        selectedIndices = [];
        goToPage('page-home');
    }

</script>

</body>
</html>